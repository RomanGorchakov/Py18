Горчаков Роман Владимирович. Вариант 4
# Лабораторная работа 2.18. Работа с переменными окружения в Python3.

Переменная среды (переменная окружения) – короткая ссылка на какой-либо объект в системе. С помощью таких сокращений, например, можно создавать универсальные пути для приложений, которые будут работать на любых ПК, независимо от имен пользователей и других параметров.

Переменная PATH позволяет запускать исполняемые файлы и скрипты, «лежащие» в определенных каталогах, без указания их точного местоположения. PATHEXT, в свою очередь, дает возможность не указывать даже расширение файла, если оно прописано в ее значениях. Принцип работы следующий: система перебирает расширения по очереди, пока не будет найден соответствующий объект, причем делает это в директориях, указанных в PATH.

Получить информацию о существующих переменных можно в свойствах системы. Для этого кликаем по ярлыку Компьютера на рабочем столе правой кнопкой мыши и выбираем соответствующий пункт. Переходим в «Дополнительные параметры». В открывшемся окне с вкладкой «Дополнительно» нажимаем кнопку, указанную на скриншоте ниже. Здесь мы видим два блока. Первый содержит пользовательские переменные, а второй системные.

Создание переменных среды:
1. Нажимаем кнопку Создать. Сделать это можно как в пользовательском разделе, так и в системном.
2. Вводим имя, например, desktop. Обратите внимание на то, чтобы такое название еще не было использовано (просмотрите списки).
3. В поле Значение указываем путь до папки Рабочий стол: C:\Users\Имя_пользователя\Desktop
4. Нажимаем ОК. Повторяем это действие во всех открытых окнах
5. Перезапускаем Проводник и консоль или целиком систему.
6. Готово, новая переменная создана, увидеть ее можно в соответствующем списке.

Переменные оболочки — переменные, которые применяются только к текущему экземпляру оболочки. Каждая оболочка, например, bash или zsh, имеет свой собственный набор внутренних переменных.

Все переменные имеют следующий формат: KEY=значение1KEY="Какое-то другое значение"KEY=значение1:значение2

При этом также следует придерживаться определенных правил:
* имена переменных чувствительны к регистру, поэтому переменные окружения должны иметь имена в верхнем регистре;
* при присвоении переменной нескольких значений они должны быть разделены символом ":";
* вокруг символа "=" не должно быть пробелов.

Существует несколько команд, с помощью которых вы можете взаимодействовать с переменными окружения и оболочки:
* команда env — позволяет запускать другую программу в пользовательском окружении без изменения в текущем окружении. При использовании без аргумента выведет список переменных текущего окружения;
* команда printenv — выводит список всех переменных окружения (или какую-то отдельно заданную переменную);
* команда set — устанавливает переменные оболочки. При использовании без аргумента выведет список всех переменных, включая переменные окружения и переменные оболочки, а также функции оболочки;
* команда unset — удаляет переменные оболочки и переменные окружения;
* команда export — создает переменную окружения.

Наиболее часто используемая команда для вывода переменных окружения — printenv. Если команде в качестве аргумента передать имя переменной, то будет отображено значение только этой переменной. Если же вызвать printenv без аргументов, то выведется построчный список всех переменных окружения. Например, чтобы отобразить значение переменной HOME , вы должны использовать команду: $ printenv HOME. В результате вы увидите путь к домашнему каталогу текущего пользователя. Если вы запустите команду printenv или env без каких-либо аргументов, то они покажут список всех переменных окружения.

Наиболее распространенные переменные окружения.
1. USER — текущий пользователь.
2. PWD — текущая директория.
3. OLDPWD — предыдущая рабочая директория. Используется оболочкой для того, чтобы вернуться в предыдущий каталог при выполнении команды "cd -".
4. HOME — домашняя директория текущего пользователя.
5. SHELL — путь к оболочке текущего пользователя (например, bash или zsh).
6. EDITOR — заданный по умолчанию редактор. Этот редактор будет вызываться в ответ на команду edit.
7. LOGNAME — имя пользователя, используемое для входа в систему.
8. PATH — пути к каталогам, в которых будет производиться поиск вызываемых команд. При выполнении команды система будет проходить по данным каталогам в указанном порядке и выберет первый из них, в котором будет находиться исполняемый файл искомой команды.
9. LANG — текущие настройки языка и кодировки.
10. TERM — тип текущего эмулятора терминала.
11. MAIL — место хранения почты текущего пользователя.
12. LS_COLORS — задает цвета, используемые для выделения объектов (например, различные типы файлов в выводе команды ls будут выделены разными цветами).

Наиболее распространенные переменные оболочки.
1. BASHOPTS — список задействованных параметров оболочки, разделенных двоеточием.
2. BASH_VERSION — версия запущенной оболочки bash.
3. COLUMNS — количество столбцов, которые используются для отображения выходных данных.
4. DIRSTACK — стек директорий, к которому можно применять команды pushd и popd .
5. HISTFILESIZE — максимальное количество строк для файла истории команд.
6. HISTSIZE — количество строк из файла истории команд, которые можно хранить в памяти.
7. HOSTNAME — имя текущего хоста.
8. IFS — внутренний разделитель поля в командной строке (по умолчанию используется пробел).
9. PS1 — определяет внешний вид строки приглашения ввода новых команд.
10. PS2 — вторичная строка приглашения.
11. SHELLOPTS — параметры оболочки, которые можно устанавливать с помощью команды set.
12. UID — идентификатор текущего пользователя.

Команды printenv и env выводят только переменные окружения. Если вы хотите получить список всех переменных, включая переменные (и функции) оболочки, то можете использовать команду set. Команда отобразит список всех переменных. Чтобы найти все переменные, содержащие заданную строку, нужно использовать команду grep: printenv | grep [ИМЯ_ПЕРЕМЕННОЙ].

Чтобы создать новую переменную оболочки с именем, например, NEW_VAR и значением Ravesli.com, достаточно просто ввести "NEW_VAR='Ravesli.com'"

Команда export используется для задания переменных окружения. С помощью данной команды мы экспортируем указанную переменную, в результате чего она будет видна во всех вновь запускаемых дочерних командных оболочках. Переменные такого типа принято называть внешними. Для создания переменной окружения необходимо экспортировать созданную переменную оболочки: "export NEW_VAR".

Если вы хотите, чтобы переменная сохранялась после закрытия сеанса оболочки, то необходимо прописать её в специальном файле. Прописать переменную можно как для текущего пользователя, так и для всех пользователей. Чтобы установить постоянную переменную окружения для текущего пользователя, откройте файл .**bashrc и для каждой переменной, которую вы хотите сделать постоянной, добавьте в конец файла строку, используя следующий синтаксис: "export [ИМЯ_ПЕРЕМЕННОЙ]=[ЗНАЧЕНИЕ_ПЕРЕМЕННОЙ]".

Чтобы задать постоянные переменные окружения для всех пользователей, создайте .shфайл в каталоге /etc/profile.**d: "sudo nano /etc/profile.d/[имя_файла].sh" Чтобы полностью удалить переменную любого типа, используйте команду unset.

Переменные окружения и оболочки всегда присутствуют в сеансах оболочки и могут быть очень полезны. Они позволяют родительским процессам устанавливать детали конфигурации для своих дочерних процессов и являются способом установки определенных параметров без использования отдельных файлов.

Переменные среды и поведение Python
1. PYTHONHOME - изменяет расположение стандартных библиотек Python.
2. PYTHONPATH - изменяет путь поиска по умолчанию для файлов модуля.
3. PYTHONSTARTUP - команды Python в этом файле выполняются до отображения первого приглашения в интерактивном режиме.
4. PYTHONOPTIMIZE - эквивалентна указанию параметра -O. Если установлено целое число, то это эквивалентно указанию -ОO.
5. PYTHONBREAKPOINT - определяет вызываемый объект с помощью точечной нотации.
6. PYTHONDEBUG - эквивалентна указанию опции -d. Если установлено целое число, то это эквивалентно многократному указанию -dd .
7. PYTHONINSPECT - эквивалентна указанию параметра -i.
8. PYTHONUNBUFFERED - эквивалентна указанию параметра -u.
9. PYTHONVERBOSE - эквивалентна указанию параметра -v. Если установлено целое число, это эквивалентно многократному указанию - v.
10. PYTHONCASEOK - Python игнорирует регистр символов в операторах импорта. Это работает только в Windows и OS X.
11. PYTHONDONTWRITEBYTECODE - Python не будет пытаться писать файлы .pyc при импорте исходных модулей. Это эквивалентно указанию параметра -B.
12. PYTHONPYCACHEPREFIX - Python будет записывать файлы .pyc в зеркальном дереве каталогов по этому пути, а не в каталогах __pycache__ в исходном дереве. Это эквивалентно указанию параметра -X pycache_prefix=PATH.
13. PYTHONHASHSEED - Если значение это переменной среды не установлено или имеет значение random, то случайное значение используется для заполнения хэшей объектов str и bytes. Если для PYTHONHASHSEED задано целочисленное значение, то оно используется как фиксированное начальное число для генерации hash() типов, охватываемых рандомизацией хэша.
14. PYTHONIOENCODING - переопределяет кодировку, используемую для stdin / stdout / stderr, в синтаксисе encodingname:errorhandler.
15. PYTHONNOUSERSITE - Python не будет добавлять пользовательский каталог site-packages в переменную sys.path.
16. PYTHONUSERBASE - определяет базовый каталог пользователя, который используется для вычисления пути к каталогу пользовательских пакетов сайта site-packages и путей установки Distutils для python setup.py install --user.
17. PYTHONWARNINGS - эквивалентна опции -W. Если она установлена в виде строки, разделенной запятыми, то это эквивалентно многократному указанию -W, при этом фильтры, расположенные позже в списке, имеют приоритет над фильтрами ранее в списке.
18. PYTHONFAULTHANDLER - при запуске вызывается faulthandler.enable(): устанавливается обработчик сигналов SIGSEGV, SIGFPE, SIGABRT, SIGBUS и SIGILL, чтобы вывести данные трассировки Python. Это эквивалентно опции обработчика ошибок -X.
19. PYTHONTRACEMALLOC - начнётся отслеживание выделения памяти Python с помощью модуля tracemalloc.
20. PYTHONPROFILEIMPORTTIME - Python покажет, сколько времени занимает каждый импорт. Это в точности эквивалентно установке -X importtime в командной строке.
21. PYTHONASYNCIODEBUG - включается режим отладки модуля asyncio.
22. PYTHONMALLOC - задаёт распределители памяти Python и/или устанавливает отладочные хуки.
23. PYTHONMALLOCSTATS - Python будет печатать статистику распределителя памяти pymalloc каждый раз, когда создается новая область объекта pymalloc, а также при завершении работы.
24. PYTHONLEGACYWINDOWSFSENCODING - кодировка файловой системы по умолчанию и режим ошибок вернутся к своим значениям mbcs и replace до версии Python 3.6 соответственно. В противном случае используются новые значения по умолчанию utf-8 и surrogatepass.
25. PYTHONLEGACYWINDOWSSTDIO - новые средства чтения и записи консоли не используются. Это означает, что символы Unicode будут закодированы в соответствии с активной кодовой страницей консоли, а не с использованием utf-8.
26. PYTHONCOERCECLOCALE - если значение этой переменной среды установлено в значение 0, то это заставит основное приложение командной строки Python пропускать приведение устаревших локалей C и POSIX на основе ASCII к более функциональной альтернативе на основе UTF-8. Если эта переменная не установлена или имеет значение, отличное от 0, то переменная среды переопределения локали LC_ALL также не задана, а текущая локаль, указанная для категории LC_CTYPE, является либо локалью C по умолчанию, либо локалью POSIX явно основанной на ASCII, то Python CLI попытается настроить следующие локали для категории LC_CTYPE в порядке, указанном перед загрузкой среды выполнения интерпретатора: C.UTF-8, C.utf8, UTF-8.
27. PYTHONDEVMODE - включится режим разработки Python, введя дополнительные проверки времени выполнения, которые слишком "дороги" для включения по умолчанию.
28. PYTHONUTF8 - если значение этой переменной среды установлено на 1, то это включает режим интерпретатора UTF-8, где UTF-8 используется как кодировка текста для системных интерфейсов, независимо от текущей настройки локали.
29. PYTHONWARNDEFAULTENCODING - код будет выдавать EncodingWarning, когда используется кодировка по умолчанию, зависящая от локали.
30. PYTHONTHREADDEBUG - Python распечатает отладочную информацию о потоках. Нужен Python, настроенный с параметром сборки --with-pydebug.
31. PYTHONDUMPREFS - Python будет сбрасывать объекты и счетчики ссылок, все еще живые после завершения работы интерпретатора.

Переменные окружения используются для изменения конфигурации системы. Результат работы многих приложений на Python зависит от значений определённых переменных окружения. Когда эти переменные изменяются, для получения прежнего результата скрипт Python требует корректировок, а это нежелательно. Эту проблему можно решить, считывая и изменяя значения нужных нам переменных в самом скрипте.

Для начала потребуется импортировать модуль os, чтобы считывать переменные. Для доступа к переменным среды в Python используется объект os.environ. С его помощью программист может получить и изменить значения всех переменных среды. Далее мы рассмотрим различные способы чтения, проверки и присвоения значения переменной среды. Для вывода имен и значений всех переменных используется цикл for. Затем выводится значение переменной HOME.

Создаём Python-файл со следующим скриптом для проверки переменных. Для чтения значений переменных мы используем модуль os, а модуль sys — для прекращения работы приложения. Бесконечный цикл while непрерывно принимает от пользователя имена переменных и проверяет их значения до тех пор, пока пользователь не введёт имя переменной, которой не присвоено значение. Если пользователь вводит имя переменной окружения, которой присвоено значение, это значение выводится, если же нет — выводится соответствующее сообщение и процесс останавливается.

Для проверки переменной DEBUG на истинность здесь используется функция get(). Программа выводит разные сообщения в зависимости от значения переменной. Для присвоения значения любой переменной среды используется функция setdefault().